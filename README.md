# 表情宇宙 / Emotion Universe

单页静态 Web 应用：用摄像头捕捉面部动作与表情，实时驱动 Three.js 粒子「球形剧场」笑脸（本地处理，不上传、不存储）。

## 功能亮点

- 镜子式交互：左右方向与照镜子一致
- 表情驱动：微笑 / 张嘴 / 闭眼（眨眼）驱动眼睛与嘴巴的粒子形变（均为封闭造型）
- 头部动作：摇头 / 点头会带动整颗粒子头部摆动
- 距离交互：靠近摄像头变大、远离变小
- 发光点阵风格：金色↔青色辉光 + 边缘高光（低端设备会自动降档）
- 海皮语音：接入智谱 GLM-Realtime，面向 5 岁幼儿园小朋友的陪伴型老师「海皮」

## 本地运行

摄像头在大多数浏览器里需要 HTTPS 或 `localhost`：

```bash
npm run dev
```

打开 `http://localhost:5173`。

### 海皮语音（GLM-Realtime）

部署到 Vercel 时，在项目环境变量里配置：

- `ZHIPU_API_KEY`：形如 `{id}.{secret}`（智谱开放平台 API Key）

本地要用海皮语音，需要启动带 `/api/zhipu-token` 的开发服务：

- 直接在页面里的「本地测试 API Key」输入框粘贴 Key（仅保存在本机 localStorage）
- 或运行：`npm run dev` / `npm run dev:local`（本地 Node 服务器，带 `/api/zhipu-token`，支持读取 `.env`）
- 或使用 Vercel CLI：`npx vercel dev`（推荐，能本地跑 `/api/zhipu-token`）

## 操作说明

- 首页只有一个按钮：点击 `开始玩` 进入互动
- 点击画面可展开/收起面板（如需调性能档位）

## URL 参数

- `?quality=high|medium|low`：强制性能档位（覆盖 Auto 选择）
- `?ears=mickey|off`：头部造型（默认 `mickey`，`off` 为纯球形）

## 兼容性提示

- 微信内置浏览器对摄像头/性能限制更常见：若卡顿或权限异常，建议右上角“在浏览器打开”。
- 第一代 iPad Pro / 低性能设备会自动进入 `Low/Lite` 路径（降粒子数、降刷新、隔帧更新颜色等）。
- 为避免 iOS/微信不供帧导致校准卡住，摄像头视频会以离屏方式保持渲染（不可见）。

## 交互要点

- 微笑：嘴巴更「上扬」、整体更明亮
- 张嘴：嘴巴从笑带过渡为闭合的「O/啊」
- 闭眼：眼睛从环形收缩为扁椭圆（仍保持封闭）
- 摇头/点头：头部以“脖子”为轴摆动
- 远近：靠近放大、远离缩小（包含点大小与整体缩放）

## 隐私

- 视频仅用于本地计算与互动渲染，不上传、不存储。
